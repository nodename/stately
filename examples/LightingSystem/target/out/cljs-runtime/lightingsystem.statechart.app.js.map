{"version":3,"sources":["lightingsystem/statechart/app.cljs"],"mappings":";AAGA,GAAA,QAAAA,2CAAAC,sDAAAC,0DAAAC;AAAA;AAAA,AAAA,yCAAA,2CAAA,2DAAA,2CAAA,1LAASC,uPACiC,WAAKC;AAAL,AAAS,+DAAA,uDAAA,kGAAA,iEAAA,lRAACC,qDAAMD;GAD1D,8DAE0C,WAAKA;AAAL,AAAS,+DAAA,uDAAA,oGAAA,iEAAA,pRAACC,qDAAMD;GAF1D,4EAG0C,WACGA;AADH,AAEE,aAAA,mFAAA,KAAA,KAAA,KAAA,3GAAME;IACAC,UAAQ,AAAA,+FAAaH;IACrBI,OAAK,iBACK,mDAAA,WAAAE,9DAACC,jBACDE;AADA,AAAa,uDAAAH,hDAACE,iEAAOL;GADrB,AAACE,gBAAMH;AAFvB,AAKE,wDAAA,jDAACD,8CAAMD,oEAAe,iBAAAU,mBAAIN;AAAJ,AAAA,oBAAAM;AAAAA;;AAAA;;;WAVpE,oEAAA,gDAAA,mFAAA,uEAAA,mFAAA,2CAAA,wDAAA,iGAAA,mFAAA,yFAAA,sFAAA,2CAAA,wDAAA,iFAAA,mEAAA,uEAAA,yDAAA,2CAAA,uEAAA,2CAAA,kEAAA,mFAAA,yEAAA,yFAAA,2CAAA,kEAAA,mFAAA;;AAiBA,GAAA,QAAAf,2CAAAC,sDAAAC,0DAAAc;AAAA;AAAA,AAAA,uCAAA,2CAAA,oEAAA,gDAAA,mFAAA,8DAAA,iEAAA,2CAAA,wDAAA,oEAAA,mFAAA,4DAAA,iEAAA,2CAAA,wDAAA,sEAAA,mFAAA,4DAAA,sFAAA,2CAAA,wDAAA,6DAAA,2DAAA,mFAAA,mFAAA,sGAAA,mEAAA,8DAAA,yDAAA,2CAAA,8DAAA,2CAAA,sEAAA,mFAAA,mFAAA,sFAAA,4DAAA,2CAAA,sEAAA,mFAAA,mFAAA,vmFAASC;;AAST,GAAA,QAAAjB,2CAAAC,sDAAAC,0DAAAgB;AAAA;AAAA,AAAA,uCAAA,2CAAA,2DAAA,2CAAA,xLAASC,oQACoC,WACGd;AADH,AAEE,+DAAA,uDAAA,kGAAA,iEAAA,lRAACC,qDAAMD;GAHtD,gFAI6C,WACGA;AADH,AAEE,IAAMe,KAAG,WAAA,XAACC;AAAD,AACG,iDAAA,mFAAA,7HAACC;GADJ;AAAT,AAGE,wDAAA,jDAAChB,8CAAMD,8EAAoBe;GAT5E,mFAU6C,WACGf;AADH,AAEE,AAACkB,aAAgB,AAAA,yGAAkBlB;;AACnC,yDAAA,lDAACmB,+CAAOnB;WAbvD,oEAAA,gDAAA,mFAAA,gEAAA,mFAAA,2CAAA,wDAAA,2EAAA,mFAAA,mEAAA,6EAAA,2CAAA,wDAAA,0EAAA,mEAAA,gEAAA,yDAAA,2CAAA,gEAAA,2CAAA,sEAAA,mFAAA,mFAAA,sFAAA,mEAAA,2CAAA,sEAAA,mFAAA,mFAAA,oFAAA,mFAAA,gGAAA,qEAAA,mFAAA,mFAAA","names":["js/lightingsystem","js/lightingsystem.statechart","js/lightingsystem.statechart.app","js/lightingsystem.statechart.app.lighting","lightingsystem.statechart.app/lighting","db","cljs.core.assoc","levels","current","next","cljs.core/cycle","p1__58753#","cljs.core.drop_while","cljs.core.not_EQ_","cljs.core/second","or__5002__auto__","js/lightingsystem.statechart.app.manual","lightingsystem.statechart.app/manual","js/lightingsystem.statechart.app.motion","lightingsystem.statechart.app/motion","id","js/setTimeout","nodename.stately.core/dispatch-transition","js/clearTimeout","cljs.core.dissoc"],"sourcesContent":["(ns lightingsystem.statechart.app\n  (:require [nodename.stately.core :refer [dispatch-transition]]))\n\n(defonce lighting\n         {:actions     {:light-on         (fn [db] (assoc db :light :on :brightness 100))\n                        :light-off        (fn [db] (assoc db :light :off :brightness 0))\n                        :cycle-brightness (fn\n                                            [db]\n                                            (let [levels [25 50 75 100]\n                                                  current (:brightness db)\n                                                  next (->> (cycle levels)\n                                                            (drop-while #(not= % current))\n                                                            second)]\n                                              (assoc db :brightness (or next 25))))}\n          :transitions {[:lighting/manual :switch-to-motion]         {:target :lighting/motion-sensing}\n                        [:lighting/motion-sensing :switch-to-manual] {:target :lighting/manual}}\n          :start-state :lighting/manual\n          :states      {:lighting/manual         {:components [:manual]}\n                        :lighting/motion-sensing {:components [:motion]}}})\n\n(defonce manual\n         {:transitions {[:manual/off :toggle]           {:target :manual/on}\n                        [:manual/on :toggle]            {:target :manual/off}\n                        [:manual/on :change-brightness] {:target  :internal\n                                                         :actions [[:cycle-brightness]]}}\n          :start-state :manual/off\n          :states      {:manual/off {:entry-actions [[:light-off]]}\n                        :manual/on  {:entry-actions [[:light-on]]}}})\n\n(defonce motion\n         {:actions     {:motion-light-on     (fn\n                                               [db]\n                                               (assoc db :light :on :brightness 80))\n                        :start-motion-timer  (fn\n                                               [db]\n                                               (let [id (js/setTimeout\n                                                          #(dispatch-transition [:timer-expired])\n                                                          5000)]\n                                                 (assoc db :motion-timer-id id)))\n                        :cancel-motion-timer (fn\n                                               [db]\n                                               (js/clearTimeout (:motion-timer-id db))\n                                               (dissoc db :motion-timer-id))}\n          :transitions {[:motion/idle :motion-detected] {:target :motion/active}\n                        [:motion/active :timer-expired] {:target :motion/idle}}\n          :start-state :motion/idle\n          :states      {:motion/idle   {:entry-actions [[:light-off]]}\n                        :motion/active {:entry-actions [[:motion-light-on]\n                                                        [:start-motion-timer]]\n                                        :exit-actions  [[:cancel-motion-timer]]}}})\n"]}